{

  "variables": {

    "aws_access_key": null,

    "aws_secret_key": null,

    "aws_region": null,

    "base_ami_id": null,
    
    "iam_instance_profile_name": null

  },

  "builders": [

    {

      "type": "amazon-ebs",

      "access_key": "{{user `aws_access_key`}}",

      "secret_key": "{{user `aws_secret_key`}}",

      "region": "{{user `aws_region`}}",

      "source_ami": "{{user `base_ami_id`}}",

      "iam_instance_profile": "{{user `iam_instance_profile_name`}}",

      "instance_type": "t2.micro",

      "ssh_username": "ec2-user",

      "ssh_pty": true,

      "ami_name": "ascent-dns-{{timestamp}}",

      "launch_block_device_mappings": [

        {

          "device_name": "/dev/sda1",

          "volume_size": 10,

          "volume_type": "gp2",

          "delete_on_termination": true

        }

      ],

      "tags": {

        "Name": "vpn-ascent"

      },

      "snapshot_tags": 

      {

        "Name": "vpn-ascent"

      }

    }

  ],

  "provisioners": [

    {

      "type": "file",

      "source": "vars",

      "destination": "/tmp/vars"

    },    
    {

      "type": "file",

      "source": "aws.server.conf",

      "destination": "/tmp/aws.server.conf"

    },
    {

      "type": "file",

      "source": "set_vars.sh",

      "destination": "/tmp/set_vars.sh"

    },
    {

      "type": "file",

      "source": "clean-all",

      "destination": "/tmp/clean-all"

    },
    {

      "type": "file",

      "source": "pkitool",

      "destination": "/tmp/pkitool"

    },
    {

      "type": "file",

      "source": "build-dh",

      "destination": "/tmp/build-dh"

    },
    {

      "type": "shell",

      "scripts": [

	"basic-packages.sh",
        "setup_openvpn.sh"


      ]

    }

  ]

}
